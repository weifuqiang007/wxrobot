# å¾®ä¿¡åç«¯è‡ªåŠ¨åŒ–ç³»ç»Ÿ - é‡æ„ç‰ˆ

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯å¾®ä¿¡åç«¯è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„é‡æ„ç‰ˆæœ¬ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„MVCæ¶æ„æ¨¡å¼ï¼Œå®ç°äº†æ¸…æ™°çš„ä»£ç ç»„ç»‡å’ŒèŒè´£åˆ†ç¦»ã€‚ç›¸æ¯”åŸç‰ˆæœ¬ï¼Œé‡æ„ç‰ˆå…·æœ‰æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

## ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

### âœ¨ æ ¸å¿ƒä¼˜åŠ¿

- **ğŸ”§ MVCæ¶æ„**: é‡‡ç”¨ç»å…¸çš„Model-View-Controlleræ¨¡å¼
- **ğŸ“¦ åˆ†å±‚è®¾è®¡**: Routes â†’ Controllers â†’ Services â†’ DAO â†’ Models
- **ğŸ”Œ æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **ğŸ›¡ï¸ é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
- **ğŸ“ æ—¥å¿—ç®¡ç†**: å®Œå–„çš„æ—¥å¿—è®°å½•å’Œç®¡ç†
- **âš¡ æ€§èƒ½ä¼˜åŒ–**: å•ä¾‹æ¨¡å¼ã€è¿æ¥æ± ç­‰ä¼˜åŒ–ç­–ç•¥

### ğŸ“ ç›®å½•ç»“æ„

```
wechat_backend/
â”œâ”€â”€ routes/                    # ğŸ›£ï¸ è·¯ç”±å±‚ - APIç«¯ç‚¹å®šä¹‰
â”‚   â”œâ”€â”€ health_routes.py       # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ status_routes.py       # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ config_routes.py       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ message_routes.py      # æ¶ˆæ¯ç®¡ç†
â”‚   â”œâ”€â”€ news_routes.py         # æ–°é—»ç®¡ç†
â”‚   â””â”€â”€ contact_routes.py      # è”ç³»äººç®¡ç†
â”œâ”€â”€ controllers/               # ğŸ® æ§åˆ¶å±‚ - ä¸šåŠ¡é€»è¾‘æ§åˆ¶
â”‚   â”œâ”€â”€ status_controller.py   # çŠ¶æ€æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ config_controller.py   # é…ç½®æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ message_controller.py  # æ¶ˆæ¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ news_controller.py     # æ–°é—»æ§åˆ¶å™¨
â”‚   â””â”€â”€ contact_controller.py  # è”ç³»äººæ§åˆ¶å™¨
â”œâ”€â”€ services/                  # âš™ï¸ æœåŠ¡å±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ app_service.py         # åº”ç”¨æœåŠ¡
â”œâ”€â”€ dao/                       # ğŸ’¾ æ•°æ®è®¿é—®å±‚ - æ•°æ®æ“ä½œ
â”‚   â”œâ”€â”€ config_dao.py          # é…ç½®æ•°æ®è®¿é—®
â”‚   â””â”€â”€ wechat_dao.py          # å¾®ä¿¡æ•°æ®è®¿é—®
â”œâ”€â”€ api_restructured.py        # ğŸš€ é‡æ„åçš„ä¸»APIæ–‡ä»¶
â”œâ”€â”€ start_restructured.py      # ğŸ¯ é‡æ„ç‰ˆå¯åŠ¨è„šæœ¬
â”œâ”€â”€ ARCHITECTURE.md            # ğŸ“Š æ¶æ„æ–‡æ¡£
â””â”€â”€ README_RESTRUCTURED.md     # ğŸ“– é‡æ„ç‰ˆè¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æ£€æŸ¥é…ç½®æ–‡ä»¶
# ç¡®ä¿ config.json å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
```

### 2. å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
python start_restructured.py
```

å¯åŠ¨è„šæœ¬æä¾›äº†å‹å¥½çš„èœå•ç•Œé¢ï¼š
- ğŸš€ å¯åŠ¨APIæœåŠ¡å™¨ï¼ˆç”Ÿäº§/è°ƒè¯•æ¨¡å¼ï¼‰
- ğŸ” ç³»ç»Ÿæ£€æŸ¥
- ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£
- âš™ï¸ æŸ¥çœ‹é…ç½®
- ğŸ“Š æŸ¥çœ‹æ¶æ„æ–‡æ¡£

#### æ–¹å¼äºŒï¼šç›´æ¥å¯åŠ¨API

```bash
python api_restructured.py
```

### 3. è®¿é—®æœåŠ¡

å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **APIæ–‡æ¡£**: http://127.0.0.1:5000/api/docs
- **å¥åº·æ£€æŸ¥**: http://127.0.0.1:5000/api/health
- **æœåŠ¡çŠ¶æ€**: http://127.0.0.1:5000/api/status

## ğŸ“š APIæ–‡æ¡£

### ğŸ¥ å¥åº·æ£€æŸ¥

```http
GET /api/health
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00",
  "version": "2.0.0",
  "uptime": "1 hour 30 minutes"
}
```

### ğŸ“Š æœåŠ¡çŠ¶æ€

```http
GET /api/status
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "wechat_connected": true,
    "auto_reply_enabled": true,
    "news_push_enabled": true,
    "last_activity": "2024-01-01T12:00:00"
  }
}
```

### âš™ï¸ é…ç½®ç®¡ç†

#### è·å–é…ç½®
```http
GET /api/config
```

#### æ›´æ–°é…ç½®
```http
POST /api/config
Content-Type: application/json

{
  "auto_reply": {
    "enabled": true,
    "default_reply": "æ„Ÿè°¢æ‚¨çš„æ¶ˆæ¯ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ï¼"
  }
}
```

### ğŸ’¬ æ¶ˆæ¯ç®¡ç†

#### å‘é€æ¶ˆæ¯
```http
POST /api/send-message
Content-Type: application/json

{
  "target": "å¥½å‹æ˜µç§°æˆ–ç¾¤å",
  "message": "è¦å‘é€çš„æ¶ˆæ¯å†…å®¹",
  "type": "friend"  // æˆ– "group"
}
```

### ğŸ‘¥ è”ç³»äººç®¡ç†

#### è·å–å¥½å‹åˆ—è¡¨
```http
GET /api/friends
```

#### è·å–ç¾¤èŠåˆ—è¡¨
```http
GET /api/groups
```

### ğŸ“° æ–°é—»ç®¡ç†

#### è·å–æ–°é—»æ¨é€ç¾¤ç»„
```http
GET /api/news/groups
```

#### æ·»åŠ æ–°é—»æ¨é€ç¾¤ç»„
```http
POST /api/news/groups
Content-Type: application/json

{
  "group_name": "ç¾¤èŠåç§°"
}
```

#### è®¾ç½®æ¨é€æ—¶é—´
```http
POST /api/news/schedule
Content-Type: application/json

{
  "time": "09:00"
}
```

## ğŸ”§ å¼€å‘æŒ‡å—

### ğŸ“ ä»£ç è§„èŒƒ

- éµå¾ªPEP 8ç¼–ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£
- ç¼–å†™å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### ğŸ§ª æµ‹è¯•

```bash
# è¿è¡ŒåŸºç¡€æµ‹è¯•
python test_basic.py

# è¿è¡Œç³»ç»Ÿæµ‹è¯•
python test_system.py
```

### ğŸ› è°ƒè¯•

å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š
```bash
python start_restructured.py
# é€‰æ‹© "2. ğŸ”§ å¯åŠ¨APIæœåŠ¡å™¨ (è°ƒè¯•æ¨¡å¼)"
```

è°ƒè¯•æ¨¡å¼ç‰¹ç‚¹ï¼š
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- è‡ªåŠ¨é‡è½½
- è°ƒè¯•å·¥å…·æ 

## ğŸ”„ ä»åŸç‰ˆæœ¬è¿ç§»

### ä¸»è¦å˜åŒ–

1. **æ–‡ä»¶ç»“æ„**: ä»å•æ–‡ä»¶å˜ä¸ºåˆ†å±‚æ¶æ„
2. **APIå…¥å£**: ä½¿ç”¨ `api_restructured.py` æ›¿ä»£ `api_fixed.py`
3. **å¯åŠ¨æ–¹å¼**: ä½¿ç”¨ `start_restructured.py` æ›¿ä»£ `start.py`
4. **é…ç½®ç®¡ç†**: æ›´å¼ºå¤§çš„é…ç½®éªŒè¯å’Œç®¡ç†

### å…¼å®¹æ€§

- âœ… APIæ¥å£å®Œå…¨å…¼å®¹
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼å…¼å®¹
- âœ… åŠŸèƒ½ç‰¹æ€§å®Œå…¨ä¿ç•™
- âœ… å¯ä¸åŸç‰ˆæœ¬å¹¶å­˜

### è¿ç§»æ­¥éª¤

1. å¤‡ä»½åŸæœ‰é…ç½®å’Œæ•°æ®
2. ä½¿ç”¨æ–°çš„å¯åŠ¨è„šæœ¬
3. éªŒè¯åŠŸèƒ½æ­£å¸¸
4. é€æ­¥è¿ç§»è‡ªå®šä¹‰ä»£ç 

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ä¾èµ–åŒ…ç¼ºå¤±
```bash
# è§£å†³æ–¹æ¡ˆ
pip install -r requirements.txt
```

#### 2. é…ç½®æ–‡ä»¶é”™è¯¯
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
python -c "import json; json.load(open('config.json'))"
```

#### 3. å¾®ä¿¡æœåŠ¡è¿æ¥å¤±è´¥
- ç¡®ä¿å¾®ä¿¡å®¢æˆ·ç«¯å·²å¯åŠ¨
- æ£€æŸ¥å¾®ä¿¡ç‰ˆæœ¬å…¼å®¹æ€§
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 4. ç«¯å£å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :5000

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨å¯åŠ¨è„šæœ¬ä¸­ï¼‰
# æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
set FLASK_PORT=5001
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f wechat_backend.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR wechat_backend.log
```

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•
- [ ] å®ç°APIè®¤è¯æœºåˆ¶
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] æ”¯æŒé…ç½®çƒ­é‡è½½

### é•¿æœŸç›®æ ‡
- [ ] æ”¯æŒå¤šå¾®ä¿¡è´¦å·
- [ ] å®ç°æ’ä»¶ç³»ç»Ÿ
- [ ] æ·»åŠ Webç®¡ç†ç•Œé¢
- [ ] æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd wechat-backend

# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements.txt
pip install pytest black flake8

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
black .

# ä»£ç æ£€æŸ¥
flake8 .
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#ğŸ› ï¸-æ•…éšœæ’é™¤) éƒ¨åˆ†
2. æŸ¥çœ‹ [æ¶æ„æ–‡æ¡£](ARCHITECTURE.md)
3. æäº¤ Issue
4. è”ç³»ç»´æŠ¤è€…

---

**ğŸ‰ æ„Ÿè°¢ä½¿ç”¨å¾®ä¿¡åç«¯è‡ªåŠ¨åŒ–ç³»ç»Ÿé‡æ„ç‰ˆï¼**